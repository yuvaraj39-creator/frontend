<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Course Management</title>
    <script src="config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #800020;
            --primary-dark: #600018;
            --primary-light: #a0334d;
            --secondary: #660099;
            --secondary-dark: #b01030;
            --secondary-light: #e34362;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --gray: #e0e0e0;
            --dark-gray: #333333;
            --black: #000000;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Toast Notification Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 100%;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.hide {
            transform: translateX(400px);
            opacity: 0;
        }

        .toast.success {
            background-color: var(--success);
        }

        .toast.error {
            background-color: var(--danger);
        }

        .toast.warning {
            background-color: var(--warning);
            color: var(--dark-gray);
        }

        .toast.info {
            background-color: var(--info);
        }

        .toast-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            font-size: 0.95rem;
        }

        .toast-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 1.1rem;
            opacity: 0.8;
            transition: opacity 0.2s;
            flex-shrink: 0;
        }

        .toast-close:hover {
            opacity: 1;
        }

        /* Login Modal Styles */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-content {
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .login-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .login-input {
            padding: 12px 15px;
            border: 1px solid var(--gray);
            border-radius: 4px;
            font-size: 1rem;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(128, 0, 32, 0.1);
        }

        .login-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
        }

        .login-btn:hover {
            background-color: var(--primary-dark);
        }

        .error-message {
            color: var(--danger);
            margin-top: 10px;
            display: none;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 20px 0;
            transition: all 0.3s;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--primary-light);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--primary-light);
        }

        .menu-item.active {
            background-color: var(--primary);
            border-left: 4px solid var(--secondary-light);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        /* Hamburger Menu */
        .hamburger-menu {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 20px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .header h1 {
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--primary);
        }

        /* Card Styles */
        .card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 30px;
        }

        .card-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray);
            border-radius: 4px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(128, 0, 32, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-error {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .form-control.error {
            border-color: var(--danger);
        }

        /* Button Styles */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-primary:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--white);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray);
            color: var(--dark-gray);
        }

        .btn-outline:hover {
            background-color: var(--light-gray);
        }

        /* Price Container */
        .price-container {
            display: flex;
            gap: 20px;
        }

        .price-container .form-group {
            flex: 1;
        }

        /* Dynamic Item Styles */
        .curriculum-item,
        .learn-item,
        .image-item {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            gap: 10px;
        }

        .curriculum-item input,
        .learn-item input,
        .image-item input {
            flex: 1;
        }

        .remove-btn {
            background-color: var(--secondary-light);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .remove-btn:hover {
            background-color: var(--secondary);
        }

        .add-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .add-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Image Preview Styles */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview {
            width: 100px;
            height: 80px;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--gray);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview .remove-preview {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
        }

        /* Course List Styles */
        .course-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .course-table th,
        .course-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray);
        }

        .course-table th {
            background-color: var(--light-gray);
            font-weight: 600;
            color: var(--primary);
            cursor: pointer;
            user-select: none;
        }

        .course-table th:hover {
            background-color: var(--gray);
        }

        .course-table tr:hover {
            background-color: rgba(128, 0, 32, 0.03);
        }

        .course-thumbnail {
            width: 60px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }

        .status-draft {
            background-color: rgba(255, 193, 7, 0.15);
            color: var(--warning);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* Search and Filter Styles */
        .search-filter-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .sort-options {
            display: flex;
            gap: 10px;
        }

        .sort-btn {
            background: none;
            border: 1px solid var(--gray);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sort-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid var(--gray);
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .pagination button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Settings Styles */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray);
        }

        /* Confirmation Modal */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .confirmation-content {
            background-color: var(--white);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .confirmation-content h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .confirmation-content p {
            margin-bottom: 20px;
            color: var(--dark-gray);
        }

        .confirmation-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .dashboard-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                transform: translateX(-100%);
                z-index: 1000;
                height: 100vh;
                overflow-y: auto;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar-menu {
                display: block;
            }

            .menu-item {
                padding: 12px 15px;
                white-space: nowrap;
            }

            .hamburger-menu {
                display: block;
            }

            .main-content {
                width: 100%;
            }

            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }

            .overlay.active {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .price-container {
                flex-direction: column;
                gap: 0;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .user-info {
                flex-direction: column;
            }

            .card-actions {
                flex-direction: column;
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
            }

            .course-table {
                display: block;
                overflow-x: auto;
            }

            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .search-filter-container {
                flex-direction: column;
            }

            .sort-options {
                flex-wrap: wrap;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            padding-bottom: 5px;
            border-bottom: 1px solid var(--gray);
        }
    </style>
</head>

<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Login Modal -->
    <div class="login-modal" id="login-modal">
        <div class="login-content">
            <h2><i class="fas fa-lock"></i> Admin Authentication</h2>
            <div class="login-form">
                <input type="password" id="admin-key" class="login-input" placeholder="Enter Admin Key" required>
                <button class="login-btn" id="login-btn">Access Dashboard</button>
                <div class="error-message" id="error-message">Invalid admin key. Please try again.</div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-modal hidden" id="confirmation-modal">
        <div class="confirmation-content">
            <h3 id="confirmation-title">Confirm Action</h3>
            <p id="confirmation-message">Are you sure you want to proceed?</p>
            <div class="confirmation-buttons">
                <button class="btn btn-secondary" id="confirmation-cancel">Cancel</button>
                <button class="btn btn-danger" id="confirmation-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <div class="dashboard-container" id="dashboard-container" style="display: none;">
        <!-- Overlay for mobile sidebar -->
        <div class="overlay" id="overlay"></div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-graduation-cap"></i> U1 Technology</h3>
                <button class="hamburger-menu" id="sidebar-toggle">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="courses">
                    <i class="fas fa-book"></i>
                    <span>Courses</span>
                </div>
                <div class="menu-item" data-section="posters">
                    <i class="fas fa-image"></i>
                    <span>Posters</span>
                </div>
                <div class="menu-item" data-section="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </div>
                <div class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="menu-item" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>
        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <div class="header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="hamburger-menu" id="mobile-menu-toggle" style="color: var(--primary);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="section-title">Course Management Dashboard</h1>
                </div>
                <div class="user-info">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=800020&color=fff" alt="Admin User">
                    <div class="user-details">
                        <span class="user-name">Admin User</span>
                        <span class="user-role">Administrator</span>
                    </div>
                </div>
            </div>

            <!-- Courses Section -->
            <div id="courses-section">
                <!-- Courses List View -->
                <div class="card" id="courses-list">
                    <div class="card-header">
                        <h2>All Courses</h2>
                        <button class="btn btn-primary" id="add-course-btn">
                            <i class="fas fa-plus"></i> Add New Course
                        </button>
                    </div>

                    <!-- Search and Filter -->
                    <div class="search-filter-container">
                        <div class="search-box">
                            <input type="text" id="course-search" class="form-control" placeholder="Search courses...">
                        </div>
                        <div class="sort-options">
                            <button class="sort-btn" data-sort="title" data-order="asc">
                                <span>Title</span>
                                <i class="fas fa-sort"></i>
                            </button>
                            <button class="sort-btn" data-sort="price" data-order="asc">
                                <span>Price</span>
                                <i class="fas fa-sort"></i>
                            </button>
                            <button class="sort-btn" data-sort="students" data-order="desc">
                                <span>Students</span>
                                <i class="fas fa-sort"></i>
                            </button>
                        </div>
                    </div>

                    <table class="course-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Title</th>
                                <th>Price</th>
                                <th>Students</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            <!-- Courses will be dynamically added here -->
                        </tbody>
                    </table>

                    <!-- Pagination -->
                    <div class="pagination" id="pagination">
                        <!-- Pagination buttons will be added here -->
                    </div>
                </div>

                <!-- Add Course Form -->
                <form id="course-form" class="hidden">
                    <!-- Basic Information -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Basic Information</h2>
                            <button type="button" class="btn btn-outline" id="back-to-list">
                                <i class="fas fa-arrow-left"></i> Back to Courses
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="course-title">Course Title</label>
                            <input type="text" id="course-title" class="form-control" placeholder="Enter course title"
                                required>
                            <div class="form-error" id="title-error">Title is required</div>
                        </div>
                        <div class="form-group">
                            <label for="course-description">Description</label>
                            <textarea id="course-description" class="form-control"
                                placeholder="Enter course description" required></textarea>
                            <div class="form-error" id="description-error">Description is required</div>
                        </div>

                        <!-- Category Section -->
                        <div class="form-group">
                            <label for="course-category">Category</label>
                            <select id="course-category" class="form-control" required>
                                <option value="">Select a category</option>
                                <option value="Programming">Programming</option>
                                <option value="Web Development">Web Development</option>
                                <option value="Artificial Intelligence (AI)">Artificial Intelligence (AI)</option>
                                <option value="Machine Learning (ML)">Machine Learning (ML)</option>
                                <option value="Data Science">Data Science</option>
                                <option value="Cloud Computing">Cloud Computing</option>
                                <option value="Cybersecurity">Cybersecurity</option>
                                <option value="Mobile App Development">Mobile App Development</option>
                                <option value="DevOps">DevOps</option>
                                <option value="Database Management">Database Management</option>
                                <option value="Software Testing">Software Testing</option>
                                <option value="UI/UX Design">UI/UX Design</option>
                                <option value="Blockchain">Blockchain</option>
                                <option value="Internet of Things (IoT)">Internet of Things (IoT)</option>
                                <option value="Game Development">Game Development</option>
                                <option value="Automation & RPA">Automation & RPA</option>
                                <option value="Digital Marketing">Digital Marketing</option>
                                <option value="Networking">Networking</option>
                                <option value="Big Data Analytics">Big Data Analytics</option>
                                <option value="Full Stack Development">Full Stack Development</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="form-error" id="category-error">Category is required</div>
                        </div>

                        <!-- Other Category Input (Initially Hidden) -->
                        <div class="form-group hidden" id="other-category-container">
                            <label for="other-category">Specify Other Category</label>
                            <input type="text" id="other-category" class="form-control"
                                placeholder="Enter custom category">
                            <div class="form-error" id="other-category-error">Please specify the category</div>
                        </div>

                        <!-- Seller Section -->
                        <div class="form-group">
                            <label for="course-seller">Seller (Optional)</label>
                            <select id="course-seller" class="form-control">
                                <option value="">Select seller type (optional)</option>
                                <option value="Top Rated">Top Rated</option>
                                <option value="Most Popular">Most Popular</option>
                                <option value="Trending Now">Trending Now</option>
                                <option value="Student Favorite">Student Favorite</option>
                                <option value="Bestseller">Bestseller</option>
                                <option value="Hot Pick">Hot Pick</option>
                                <option value="Editor's Choice">Editor's Choice</option>
                                <option value="Featured Course">Featured Course</option>
                                <option value="Highly Recommended">Highly Recommended</option>
                                <option value="Top Choice">Top Choice</option>
                            </select>
                        </div>

                        <!-- Mini Description Section -->
                        <div class="form-group">
                            <label for="course-mini-description">Mini Description</label>
                            <textarea id="course-mini-description" class="form-control"
                                placeholder="Enter a brief mini description (2-3 lines)" maxlength="200"></textarea>
                            <div class="form-error" id="mini-description-error">Mini description is required</div>
                            <small style="color: var(--gray); font-size: 0.8rem;">Maximum 200 characters</small>
                        </div>

                        <div class="form-group">
                            <label>Course Images</label>
                            <div id="image-items-container">
                                <div class="image-item">
                                    <input type="url" class="form-control image-url-input" placeholder="Enter image URL"
                                        required>
                                    <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                                </div>
                            </div>
                            <div class="image-preview-container" id="image-preview-container">
                                <!-- Image previews will be added here -->
                            </div>
                            <button type="button" class="add-btn" id="add-image-item">
                                <i class="fas fa-plus"></i> Add Another Image
                            </button>
                        </div>
                    </div>

                    <!-- Pricing -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Offline Pricing</h2>
                        </div>
                        <div class="price-container">
                            <div class="form-group">
                                <label for="offline-price">Price (₹)</label>
                                <input type="number" id="offline-price" class="form-control"
                                    placeholder="Enter current price" step="0.01" min="0" required>
                                <div class="form-error" id="offline-price-error">Price must be a positive number</div>
                            </div>
                            <div class="form-group">
                                <label for="offline-original-price">Original Price (₹)</label>
                                <input type="number" id="offline-original-price" class="form-control"
                                    placeholder="Enter original price" step="0.01" min="0">
                                <div class="form-error" id="offline-original-price-error">Price must be a positive
                                    number</div>
                            </div>
                        </div>
                        <div class="card-header">
                            <h2>Online Pricing</h2>
                        </div>
                        <div class="price-container">
                            <div class="form-group">
                                <label for="online-price">Price (₹)</label>
                                <input type="number" id="online-price" class="form-control"
                                    placeholder="Enter current price" step="0.01" min="0" required>
                                <div class="form-error" id="online-price-error">Price must be a positive number</div>
                            </div>
                            <div class="form-group">
                                <label for="online-original-price">Original Price (₹)</label>
                                <input type="number" id="online-original-price" class="form-control"
                                    placeholder="Enter original price" step="0.01" min="0">
                                <div class="form-error" id="online-original-price-error">Price must be a positive number
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Tools & Language Section -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Learning Tools & Language</h2>
                        </div>
                        <div id="tools-language-container">
                            <div class="learn-item">
                                <input type="text" class="form-control tools-language-input"
                                    placeholder="Enter tool or language (e.g., Python, React, Photoshop)" required>
                                <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" id="add-tools-language-item">
                            <i class="fas fa-plus"></i> Add Tool or Language
                        </button>
                    </div>

                    <!-- What You'll Learn -->
                    <div class="card">
                        <div class="card-header">
                            <h2>What You'll Learn</h2>
                        </div>
                        <div id="learn-items-container">
                            <div class="learn-item">
                                <input type="text" class="form-control" placeholder="Enter learning point" required>
                                <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" id="add-learn-item">
                            <i class="fas fa-plus"></i> Add Learning Point
                        </button>
                    </div>

                    <!-- Curriculum -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Curriculum</h2>
                        </div>
                        <div id="curriculum-container">
                            <div class="form-group">
                                <label class="section-title">Section 1: <input type="text"
                                        style="width: auto; display: inline-block; padding: 5px; border: 1px solid var(--gray); border-radius: 4px;"
                                        placeholder="Section title" value="Introduction"></label>
                                <div class="curriculum-lectures">
                                    <div class="curriculum-item">
                                        <input type="text" class="form-control" placeholder="Enter lecture title" required>
                                        <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-20">
                            <button type="button" class="add-btn" id="add-curriculum-item">
                                <i class="fas fa-plus"></i> Add Lecture
                            </button>
                            <button type="button" class="add-btn" id="add-section"
                                style="background-color: var(--secondary);">
                                <i class="fas fa-plus"></i> Add Section
                            </button>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="form-group text-right">
                        <button type="button" class="btn btn-secondary" id="cancel-course-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="save-course-btn" disabled>Save Course</button>
                    </div>
                </form>
            </div>
            <!-- Poster Section -->
            <div id="poster-section" class="hidden">
                <!-- Posters List View -->
                <div class="card" id="posters-list">
                    <div class="card-header">
                        <h2>All Posters</h2>
                        <button class="btn btn-primary" id="add-poster-btn">
                            <i class="fas fa-plus"></i> Add New Poster
                        </button>
                    </div>

                    <!-- Search and Filter -->
                    <div class="search-filter-container">
                        <div class="search-box">
                            <input type="text" id="poster-search" class="form-control" placeholder="Search posters...">
                        </div>
                        <div class="sort-options">
                            <button class="sort-btn" data-sort="title" data-order="asc">
                                <span>Title</span>
                                <i class="fas fa-sort"></i>
                            </button>
                            <button class="sort-btn" data-sort="createdAt" data-order="desc">
                                <span>Date</span>
                                <i class="fas fa-sort"></i>
                            </button>
                        </div>
                    </div>

                    <table class="course-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Title</th>
                                <th>Content Items</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="posters-table-body">
                            <!-- Posters will be dynamically added here -->
                        </tbody>
                    </table>

                    <!-- Pagination -->
                    <div class="pagination" id="poster-pagination">
                        <!-- Pagination buttons will be added here -->
                    </div>
                </div>

                <!-- Add Poster Form (Initially Hidden) -->
                <form id="poster-form" class="hidden">
                    <!-- Basic Information -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Poster Information</h2>
                            <button type="button" class="btn btn-outline" id="back-to-posters-list">
                                <i class="fas fa-arrow-left"></i> Back to Posters
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="poster-title">Poster Title</label>
                            <input type="text" id="poster-title" class="form-control" placeholder="Enter poster title"
                                required>
                            <div class="form-error" id="poster-title-error">Title is required</div>
                        </div>
                        <div class="form-group">
                            <label>Poster Images</label>
                            <div id="poster-image-container">
                                <div class="image-item">
                                    <input type="url" class="form-control poster-image-url"
                                        placeholder="Enter image URL" required>
                                    <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                                </div>
                            </div>
                            <div class="image-preview-container" id="poster-image-preview">
                                <!-- Image preview will be added here -->
                            </div>
                            <button type="button" class="add-btn" id="add-poster-image-item">
                                <i class="fas fa-plus"></i> Add Another Image
                            </button>
                        </div>
                    </div>

                    <!-- Content Section -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Content</h2>
                        </div>
                        <div id="content-items-container">
                            <div class="learn-item">
                                <input type="text" class="form-control content-input" placeholder="Enter content point"
                                    required>
                                <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" id="add-content-item">
                            <i class="fas fa-plus"></i> Add Content Point
                        </button>
                    </div>

                    <!-- Actions -->
                    <div class="form-group text-right">
                        <button type="button" class="btn btn-secondary" id="cancel-poster-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="save-poster-btn" disabled>Save Poster</button>
                    </div>
                </form>
            </div>
            <!-- Analytics Section -->
            <div id="analytics-section" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Course Analytics</h2>
                    </div>

                    <!-- Stats Cards -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="card text-center">
                            <h3 style="color: var(--primary); font-size: 2rem; margin-bottom: 10px;" id="total-courses">
                                0</h3>
                            <p>Total Courses</p>
                        </div>
                        <div class="card text-center">
                            <h3 style="color: var(--primary); font-size: 2rem; margin-bottom: 10px;"
                                id="total-students">0</h3>
                            <p>Total Students</p>
                        </div>
                        <div class="card text-center">
                            <h3 style="color: var(--primary); font-size: 2rem; margin-bottom: 10px;" id="total-revenue">
                                ₹0</h3>
                            <p>Total Revenue</p>
                        </div>
                        <div class="card text-center">
                            <h3 style="color: var(--primary); font-size: 2rem; margin-bottom: 10px;"
                                id="completion-rate">0%</h3>
                            <p>Completion Rate</p>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="card">
                            <div class="card-header">
                                <h3>Enrollment Trends</h3>
                            </div>
                            <div style="height: 300px;">
                                <canvas id="enrollment-chart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Popular Courses</h3>
                            </div>
                            <div style="height: 300px;">
                                <canvas id="popularity-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Settings Section (Initially Hidden) -->
            <div id="settings-section" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Platform Settings</h2>
                    </div>

                    <div class="settings-section">
                        <h2>General Settings</h2>
                        <div class="form-group">
                            <label for="site-name">Site Name</label>
                            <input type="text" id="site-name" class="form-control" value="U1 Technology">
                        </div>
                        <div class="form-group">
                            <label for="admin-email">Admin Email</label>
                            <input type="email" id="admin-email" class="form-control" value="admin@u1technology.com">
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Security Settings</h2>
                        <div class="form-group">
                            <label for="admin-password">Change Admin Password</label>
                            <input type="password" id="admin-password" class="form-control"
                                placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirm Password</label>
                            <input type="password" id="confirm-password" class="form-control"
                                placeholder="Confirm new password">
                        </div>
                    </div>

                    <div class="form-group text-right">
                        <button class="btn btn-primary" id="save-settings-btn">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    const loginModal = document.getElementById('login-modal');
    const dashboardContainer = document.getElementById('dashboard-container');
    const adminKeyInput = document.getElementById('admin-key');
    const loginBtn = document.getElementById('login-btn');
    const errorMessage = document.getElementById('error-message');
    const toastContainer = document.getElementById('toast-container');
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const overlay = document.getElementById('overlay');
    const menuItems = document.querySelectorAll('.menu-item');
    const sectionTitle = document.getElementById('section-title');
    const sections = {
        courses: document.getElementById('courses-section'),
        analytics: document.getElementById('analytics-section'),
        settings: document.getElementById('settings-section'),
        posters: document.getElementById('poster-section')
    };
    const logoutBtn = document.getElementById('logout-btn');
    const coursesList = document.getElementById('courses-list');
    const courseForm = document.getElementById('course-form');
    const addCourseBtn = document.getElementById('add-course-btn');
    const backToListBtn = document.getElementById('back-to-list');
    const cancelCourseBtn = document.getElementById('cancel-course-btn');
    const saveCourseBtn = document.getElementById('save-course-btn');
    const courseSearch = document.getElementById('course-search');
    const sortButtons = document.querySelectorAll('.sort-btn');
    const coursesTableBody = document.getElementById('courses-table-body');
    const pagination = document.getElementById('pagination');
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmationTitle = document.getElementById('confirmation-title');
    const confirmationMessage = document.getElementById('confirmation-message');
    const confirmationCancel = document.getElementById('confirmation-cancel');
    const confirmationConfirm = document.getElementById('confirmation-confirm');
    const saveSettingsBtn = document.getElementById('save-settings-btn');
    const postersList = document.getElementById('posters-list');
    const posterForm = document.getElementById('poster-form');
    const addPosterBtn = document.getElementById('add-poster-btn');
    const backToPostersListBtn = document.getElementById('back-to-posters-list');
    const cancelPosterBtn = document.getElementById('cancel-poster-btn');
    const savePosterBtn = document.getElementById('save-poster-btn');
    const posterSearch = document.getElementById('poster-search');
    const postersTableBody = document.getElementById('posters-table-body');
    const posterPagination = document.getElementById('poster-pagination');
    const addPosterImageItemBtn = document.getElementById('add-poster-image-item');

    let enrollmentChart = null;
    let popularityChart = null;

    let courses = [];
    let currentCourseId = null;
    let currentPage = 1;
    const coursesPerPage = 5;
    let searchTerm = '';
    let sortField = 'title';
    let sortOrder = 'asc';
    let posters = [];
    let currentPosterId = null;
    let currentPosterPage = 1;
    const postersPerPage = 5;
    let posterSearchTerm = '';
    let posterSortField = 'title';
    let posterSortOrder = 'asc';

    const API_BASE = (function () {
        if (window.location.port === '5501' || window.location.hostname === '127.0.0.1') {
            return 'http://localhost:3000';
        }
        return window.location.origin;
    })();

    function initDashboard() {
        const token = localStorage.getItem('adminToken');
        if (token) {
            verifyToken(token);
        } else {
            showLoginModal();
        }

        setupEventListeners();
    }

    async function verifyToken(token) {
        try {
            const response = await fetch(`${API_BASE}/api/admin/me`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const result = await response.json();
                if (result.success && result.data.user.role === 'admin') {
                    showDashboard();
                    loadCourses();
                    return;
                }
            }

            localStorage.removeItem('adminToken');
            showLoginModal();
        } catch (error) {
            localStorage.removeItem('adminToken');
            showLoginModal();
        }
    }

    function showLoginModal() {
        loginModal.style.display = 'flex';
        dashboardContainer.style.display = 'none';
    }

    function showDashboard() {
        loginModal.style.display = 'none';
        dashboardContainer.style.display = 'flex';
        showSection('courses');
    }

    function setupEventListeners() {
        loginBtn.addEventListener('click', handleLogin);
        adminKeyInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleLogin();
        });

        sidebarToggle.addEventListener('click', toggleSidebar);
        mobileMenuToggle.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);

        menuItems.forEach(item => {
            if (item.id !== 'logout-btn') {
                item.addEventListener('click', (e) => {
                    const section = item.getAttribute('data-section');
                    showSection(section);
                    if (window.innerWidth <= 992) {
                        toggleSidebar();
                    }
                });
            }
        });

        logoutBtn.addEventListener('click', handleLogout);

        addCourseBtn.addEventListener('click', () => showCourseForm());
        backToListBtn.addEventListener('click', showCoursesList);
        cancelCourseBtn.addEventListener('click', handleCancelCourse);
        courseForm.addEventListener('submit', handleSaveCourse);

        courseSearch.addEventListener('input', handleSearch);
        sortButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const field = btn.getAttribute('data-sort');
                const order = btn.getAttribute('data-order');

                sortButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const newOrder = order === 'asc' ? 'desc' : 'asc';
                btn.setAttribute('data-order', newOrder);

                const icon = btn.querySelector('i');
                icon.className = newOrder === 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down';

                sortField = field;
                sortOrder = newOrder;
                renderCoursesTable();
            });
        });

        setupFormValidation();
        setupDynamicFormElements();
        saveSettingsBtn.addEventListener('click', saveSettings);

        confirmationCancel.addEventListener('click', () => {
            confirmationModal.classList.add('hidden');
        });

        addPosterBtn.addEventListener('click', () => showPosterForm());
        backToPostersListBtn.addEventListener('click', showPostersList);
        cancelPosterBtn.addEventListener('click', handleCancelPoster);
        posterForm.addEventListener('submit', handleSavePoster);

        posterSearch.addEventListener('input', handlePosterSearch);

        setupPosterFormValidation();
        setupDynamicPosterFormElements();

        // Add event listener for the new tools/language button
        document.getElementById('add-tools-language-item').addEventListener('click', () => {
            const container = document.getElementById('tools-language-container');
            const newItem = createToolsLanguageItem();
            container.appendChild(newItem);
            setupDynamicFormElements();
        });

        // Add event listener for category dropdown
        const categorySelect = document.getElementById('course-category');
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                validateField(this);
                validateForm();
                saveCourseDraft();
                
                // Show/hide other category input
                const otherCategoryContainer = document.getElementById('other-category-container');
                if (this.value === 'other') {
                    otherCategoryContainer.classList.remove('hidden');
                } else {
                    otherCategoryContainer.classList.add('hidden');
                }
            });
        }
        
        // Add event listener for other category input
        const otherCategoryInput = document.getElementById('other-category');
        if (otherCategoryInput) {
            otherCategoryInput.addEventListener('input', function() {
                validateField(this);
                validateForm();
                saveCourseDraft();
            });
        }
        
        // Add event listener for seller dropdown
        const sellerSelect = document.getElementById('course-seller');
        if (sellerSelect) {
            sellerSelect.addEventListener('change', function() {
                saveCourseDraft();
            });
        }
        
        // Add event listener for poster image add button
        addPosterImageItemBtn.addEventListener('click', () => {
            const container = document.getElementById('poster-image-container');
            const newItem = createPosterImageItem();
            container.appendChild(newItem);
            setupDynamicPosterFormElements();
        });
    }

    async function handleLogin() {
        const email = 'admin@u1technology.com';
        const password = adminKeyInput.value.trim();

        if (!password) {
            showError('Please enter admin password');
            return;
        }

        try {
            showToast('Logging in...', 'info');

            const response = await fetch(`${API_BASE}/api/admin/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Login failed: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();

            if (result.success && result.data.user.role === 'admin') {
                localStorage.setItem('adminToken', result.data.token);
                showDashboard();
                showToast('Login successful!', 'success');
            } else {
                showError(result.message || 'Invalid admin credentials');
            }
        } catch (error) {
            showError('Login failed. Please check your credentials and try again.');
        }
    }

    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        adminKeyInput.classList.add('error');
    }

    function handleLogout() {
        localStorage.removeItem('adminToken');
        showLoginModal();
        adminKeyInput.value = '';
        errorMessage.style.display = 'none';
        adminKeyInput.classList.remove('error');
        showToast('You have been logged out.', 'info');
    }

    function toggleSidebar() {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    function showSection(section) {
        Object.values(sections).forEach(sec => {
            if (sec) sec.classList.add('hidden');
        });

        if (sections[section]) {
            sections[section].classList.remove('hidden');
        }

        menuItems.forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('data-section') === section) {
                item.classList.add('active');
            }
        });

        const titles = {
            courses: 'Course Management',
            analytics: 'Analytics Dashboard',
            settings: 'Platform Settings',
            posters: 'Poster Management'
        };
        sectionTitle.textContent = titles[section] || 'Dashboard';

        if (section === 'analytics') {
            loadAnalytics();
        } else if (section === 'posters') {
            loadPosters();
        }
    }

    async function loadCourses() {
        try {
            const token = localStorage.getItem('adminToken');
            const response = await fetch(`${API_BASE}/api/courses`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch courses');
            }

            const result = await response.json();

            if (result.success) {
                courses = result.data.courses;
                renderCoursesTable();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showToast('Failed to load courses', 'error');
            courses = [];
            renderCoursesTable();
        }
    }

    function showCoursesList() {
        coursesList.classList.remove('hidden');
        courseForm.classList.add('hidden');
        loadCourses();
    }

    function showCourseForm(courseId = null) {
        coursesList.classList.add('hidden');
        courseForm.classList.remove('hidden');

        currentCourseId = courseId;

        if (courseId) {
            const course = courses.find(c => c._id === courseId);
            if (course) {
                populateCourseForm(course);
            }
        } else {
            resetCourseForm();
        }

        loadCourseDraft();
    }

    function populateCourseForm(course) {
        document.getElementById('course-title').value = course.title || '';
        document.getElementById('course-description').value = course.description || '';
        document.getElementById('course-mini-description').value = course.miniDescription || '';
        document.getElementById('course-category').value = course.category || '';
        document.getElementById('course-seller').value = course.seller || '';
        
        // Handle other category
        const otherCategoryContainer = document.getElementById('other-category-container');
        if (course.category === 'other' && course.otherCategory) {
            otherCategoryContainer.classList.remove('hidden');
            document.getElementById('other-category').value = course.otherCategory || '';
        } else {
            otherCategoryContainer.classList.add('hidden');
        }

        // Handle images
        const imageContainer = document.getElementById('image-items-container');
        imageContainer.innerHTML = '';
        if (course.images && course.images.length > 0) {
            course.images.forEach((image, index) => {
                const imageItem = createImageItem();
                imageItem.querySelector('.image-url-input').value = image;
                imageContainer.appendChild(imageItem);
            });
        } else {
            imageContainer.appendChild(createImageItem());
        }
        updateImagePreviews();

        // Handle pricing
        document.getElementById('offline-price').value = course.offlinePrice || '';
        document.getElementById('offline-original-price').value = course.offlineOriginalPrice || '';
        document.getElementById('online-price').value = course.onlinePrice || '';
        document.getElementById('online-original-price').value = course.onlineOriginalPrice || '';

        // Handle learning tools & language
        const toolsContainer = document.getElementById('tools-language-container');
        toolsContainer.innerHTML = '';
        if (course.toolsLanguage && course.toolsLanguage.length > 0) {
            course.toolsLanguage.forEach(tool => {
                const toolItem = createToolsLanguageItem();
                toolItem.querySelector('.tools-language-input').value = tool;
                toolsContainer.appendChild(toolItem);
            });
        } else {
            toolsContainer.appendChild(createToolsLanguageItem());
        }

        // Handle learning points
        const learnContainer = document.getElementById('learn-items-container');
        learnContainer.innerHTML = '';
        if (course.learn && course.learn.length > 0) {
            course.learn.forEach(point => {
                const learnItem = createLearnItem();
                learnItem.querySelector('input').value = point;
                learnContainer.appendChild(learnItem);
            });
        } else {
            learnContainer.appendChild(createLearnItem());
        }

        // Handle curriculum
        const curriculumContainer = document.getElementById('curriculum-container');
        curriculumContainer.innerHTML = '';
        if (course.curriculum && course.curriculum.length > 0) {
            course.curriculum.forEach(section => {
                const sectionElement = createCurriculumSection(section.title);
                const lecturesContainer = sectionElement.querySelector('.curriculum-lectures');
                
                section.lectures.forEach(lecture => {
                    const lectureItem = createCurriculumItem();
                    lectureItem.querySelector('input').value = lecture;
                    lecturesContainer.appendChild(lectureItem);
                });
                
                curriculumContainer.appendChild(sectionElement);
            });
        } else {
            curriculumContainer.appendChild(createCurriculumSection('Introduction'));
        }

        setupDynamicFormElements();
        validateForm();
    }

    function resetCourseForm() {
        document.getElementById('course-title').value = '';
        document.getElementById('course-description').value = '';
        document.getElementById('course-mini-description').value = '';
        document.getElementById('course-category').value = '';
        document.getElementById('course-seller').value = '';
        document.getElementById('other-category').value = '';
        document.getElementById('other-category-container').classList.add('hidden');
        
        // Reset images
        const imageContainer = document.getElementById('image-items-container');
        imageContainer.innerHTML = '';
        imageContainer.appendChild(createImageItem());
        updateImagePreviews();

        // Reset pricing
        document.getElementById('offline-price').value = '';
        document.getElementById('offline-original-price').value = '';
        document.getElementById('online-price').value = '';
        document.getElementById('online-original-price').value = '';

        // Reset learning tools & language
        const toolsContainer = document.getElementById('tools-language-container');
        toolsContainer.innerHTML = '';
        toolsContainer.appendChild(createToolsLanguageItem());

        // Reset learning points
        const learnContainer = document.getElementById('learn-items-container');
        learnContainer.innerHTML = '';
        learnContainer.appendChild(createLearnItem());

        // Reset curriculum
        const curriculumContainer = document.getElementById('curriculum-container');
        curriculumContainer.innerHTML = '';
        curriculumContainer.appendChild(createCurriculumSection('Introduction'));

        setupDynamicFormElements();
        validateForm();
    }

    function createImageItem() {
        const div = document.createElement('div');
        div.className = 'image-item';
        div.innerHTML = `
            <input type="url" class="form-control image-url-input" placeholder="Enter image URL" required>
            <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
        `;
        return div;
    }

    function createToolsLanguageItem() {
        const div = document.createElement('div');
        div.className = 'learn-item';
        div.innerHTML = `
            <input type="text" class="form-control tools-language-input" placeholder="Enter tool or language (e.g., Python, React, Photoshop)" required>
            <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
        `;
        return div;
    }

    function createLearnItem() {
        const div = document.createElement('div');
        div.className = 'learn-item';
        div.innerHTML = `
            <input type="text" class="form-control" placeholder="Enter learning point" required>
            <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
        `;
        return div;
    }

    function createCurriculumSection(title = 'New Section') {
        const div = document.createElement('div');
        div.className = 'form-group';
        div.innerHTML = `
            <label class="section-title">Section <span class="section-number">1</span>: 
                <input type="text" style="width: auto; display: inline-block; padding: 5px; border: 1px solid var(--gray); border-radius: 4px;" 
                    placeholder="Section title" value="${title}" required>
            </label>
            <div class="curriculum-lectures">
                <div class="curriculum-item">
                    <input type="text" class="form-control" placeholder="Enter lecture title" required>
                    <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
                </div>
            </div>
        `;
        return div;
    }

    function createCurriculumItem() {
        const div = document.createElement('div');
        div.className = 'curriculum-item';
        div.innerHTML = `
            <input type="text" class="form-control" placeholder="Enter lecture title" required>
            <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
        `;
        return div;
    }

    function setupDynamicFormElements() {
        // Image URL inputs
        document.querySelectorAll('.image-url-input').forEach(input => {
            input.removeEventListener('input', handleImageUrlInput);
            input.addEventListener('input', handleImageUrlInput);
        });

        // Remove buttons for images
        document.querySelectorAll('#image-items-container .remove-btn').forEach(btn => {
            btn.removeEventListener('click', handleRemoveImageItem);
            btn.addEventListener('click', handleRemoveImageItem);
        });

        // Remove buttons for learning points
        document.querySelectorAll('#learn-items-container .remove-btn').forEach(btn => {
            btn.removeEventListener('click', handleRemoveLearnItem);
            btn.addEventListener('click', handleRemoveLearnItem);
        });

        // Remove buttons for tools/language
        document.querySelectorAll('#tools-language-container .remove-btn').forEach(btn => {
            btn.removeEventListener('click', handleRemoveToolsLanguageItem);
            btn.addEventListener('click', handleRemoveToolsLanguageItem);
        });

        // Remove buttons for curriculum items
        document.querySelectorAll('.curriculum-item .remove-btn').forEach(btn => {
            btn.removeEventListener('click', handleRemoveCurriculumItem);
            btn.addEventListener('click', handleRemoveCurriculumItem);
        });

        // Section title inputs
        document.querySelectorAll('.section-title input').forEach(input => {
            input.removeEventListener('input', saveCourseDraft);
            input.addEventListener('input', saveCourseDraft);
        });

        // Curriculum inputs
        document.querySelectorAll('.curriculum-item input').forEach(input => {
            input.removeEventListener('input', saveCourseDraft);
            input.addEventListener('input', saveCourseDraft);
        });

        // Add event listeners for the add buttons
        document.getElementById('add-image-item').onclick = () => {
            const container = document.getElementById('image-items-container');
            const newItem = createImageItem();
            container.appendChild(newItem);
            setupDynamicFormElements();
            saveCourseDraft();
        };

        document.getElementById('add-learn-item').onclick = () => {
            const container = document.getElementById('learn-items-container');
            const newItem = createLearnItem();
            container.appendChild(newItem);
            setupDynamicFormElements();
            saveCourseDraft();
        };

        document.getElementById('add-tools-language-item').onclick = () => {
            const container = document.getElementById('tools-language-container');
            const newItem = createToolsLanguageItem();
            container.appendChild(newItem);
            setupDynamicFormElements();
            saveCourseDraft();
        };

        document.getElementById('add-curriculum-item').onclick = () => {
            const lastSection = document.querySelector('#curriculum-container .form-group:last-child');
            if (lastSection) {
                const lecturesContainer = lastSection.querySelector('.curriculum-lectures');
                const newItem = createCurriculumItem();
                lecturesContainer.appendChild(newItem);
                setupDynamicFormElements();
                saveCourseDraft();
            }
        };

        document.getElementById('add-section').onclick = () => {
            const container = document.getElementById('curriculum-container');
            const sections = container.querySelectorAll('.form-group');
            const newSection = createCurriculumSection(`Section ${sections.length + 1}`);
            container.appendChild(newSection);
            updateSectionNumbers();
            setupDynamicFormElements();
            saveCourseDraft();
        };

        // Add input event listeners for form validation
        document.querySelectorAll('#course-form input, #course-form textarea, #course-form select').forEach(input => {
            input.removeEventListener('input', validateForm);
            input.addEventListener('input', validateForm);
        });
    }

    function handleRemoveImageItem(e) {
        const container = document.getElementById('image-items-container');
        if (container.children.length > 1) {
            e.target.closest('.image-item').remove();
            updateImagePreviews();
            saveCourseDraft();
        } else {
            showToast('At least one image is required', 'warning');
        }
    }

    function handleRemoveLearnItem(e) {
        const container = document.getElementById('learn-items-container');
        if (container.children.length > 1) {
            e.target.closest('.learn-item').remove();
            saveCourseDraft();
        } else {
            showToast('At least one learning point is required', 'warning');
        }
    }

    function handleRemoveToolsLanguageItem(e) {
        const container = document.getElementById('tools-language-container');
        if (container.children.length > 1) {
            e.target.closest('.learn-item').remove();
            saveCourseDraft();
        } else {
            showToast('At least one tool or language is required', 'warning');
        }
    }

    function handleRemoveCurriculumItem(e) {
        const curriculumItem = e.target.closest('.curriculum-item');
        const lecturesContainer = curriculumItem.parentElement;
        
        if (lecturesContainer.children.length > 1) {
            curriculumItem.remove();
            saveCourseDraft();
        } else {
            showToast('Each section must have at least one lecture', 'warning');
        }
    }

    function updateSectionNumbers() {
        const sections = document.querySelectorAll('#curriculum-container .form-group');
        sections.forEach((section, index) => {
            const numberSpan = section.querySelector('.section-number');
            if (numberSpan) {
                numberSpan.textContent = index + 1;
            }
        });
    }

    function handleImageUrlInput(e) {
        updateImagePreviews();
        saveCourseDraft();
    }

    function updateImagePreviews() {
        const container = document.getElementById('image-preview-container');
        container.innerHTML = '';

        document.querySelectorAll('.image-url-input').forEach((input, index) => {
            const url = input.value.trim();
            if (url) {
                const preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.innerHTML = `
                    <img src="${url}" alt="Preview ${index + 1}" onerror="this.style.display='none'">
                    <span>Image ${index + 1}</span>
                `;
                container.appendChild(preview);
            }
        });
    }

    function setupFormValidation() {
        const form = document.getElementById('course-form');
        const inputs = form.querySelectorAll('input, textarea, select');

        inputs.forEach(input => {
            input.addEventListener('blur', (e) => validateField(e.target));
            input.addEventListener('input', (e) => {
                validateField(e.target);
                validateForm();
                saveCourseDraft();
            });
        });

        // Special handling for category dropdown
        const categorySelect = document.getElementById('course-category');
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                validateField(this);
                validateForm();
                saveCourseDraft();
                
                // Show/hide other category input
                const otherCategoryContainer = document.getElementById('other-category-container');
                if (this.value === 'other') {
                    otherCategoryContainer.classList.remove('hidden');
                } else {
                    otherCategoryContainer.classList.add('hidden');
                }
            });
        }
    }

    function validateField(field) {
        const errorElement = document.getElementById(`${field.id}-error`);
        if (!errorElement) return;

        let isValid = true;
        let errorMessage = '';

        switch (field.type) {
            case 'text':
            case 'textarea':
                if (field.required && !field.value.trim()) {
                    isValid = false;
                    errorMessage = 'This field is required';
                }
                break;
            case 'number':
                if (field.required && (!field.value || parseFloat(field.value) < 0)) {
                    isValid = false;
                    errorMessage = 'Price must be a positive number';
                }
                break;
            case 'select-one':
                if (field.required && !field.value) {
                    isValid = false;
                    errorMessage = 'This field is required';
                }
                break;
            case 'url':
                if (field.required && !field.value.trim()) {
                    isValid = false;
                    errorMessage = 'Image URL is required';
                } else if (field.value.trim() && !isValidUrl(field.value.trim())) {
                    isValid = false;
                    errorMessage = 'Please enter a valid URL';
                }
                break;
        }

        // Special validation for other category
        if (field.id === 'other-category') {
            const categorySelect = document.getElementById('course-category');
            if (categorySelect.value === 'other' && !field.value.trim()) {
                isValid = false;
                errorMessage = 'Please specify the category';
            }
        }

        if (isValid) {
            field.classList.remove('error');
            errorElement.style.display = 'none';
        } else {
            field.classList.add('error');
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
        }

        return isValid;
    }

    function isValidUrl(string) {
        try {
            new URL(string);
            return true;
        } catch (_) {
            return false;
        }
    }

    function validateForm() {
        const form = document.getElementById('course-form');
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!validateField(field)) {
                isValid = false;
            }
        });

        // Special validation for other category
        const categorySelect = document.getElementById('course-category');
        const otherCategoryInput = document.getElementById('other-category');
        if (categorySelect.value === 'other' && !otherCategoryInput.value.trim()) {
            isValid = false;
        }

        // Validate at least one image URL
        const imageUrls = document.querySelectorAll('.image-url-input');
        let hasValidImage = false;
        imageUrls.forEach(input => {
            if (input.value.trim() && isValidUrl(input.value.trim())) {
                hasValidImage = true;
            }
        });
        if (!hasValidImage) {
            isValid = false;
        }

        saveCourseBtn.disabled = !isValid;
        return isValid;
    }

    function handleCancelCourse() {
        if (isFormDirty()) {
            showConfirmation(
                'Discard Changes?',
                'You have unsaved changes. Are you sure you want to discard them?',
                () => {
                    clearCourseDraft();
                    showCoursesList();
                }
            );
        } else {
            showCoursesList();
        }
    }

    function isFormDirty() {
        const draft = localStorage.getItem('courseDraft');
        return draft !== null;
    }

    function saveCourseDraft() {
        if (!validateForm()) return;

        const formData = {
            title: document.getElementById('course-title').value,
            description: document.getElementById('course-description').value,
            miniDescription: document.getElementById('course-mini-description').value,
            category: document.getElementById('course-category').value,
            otherCategory: document.getElementById('other-category').value,
            seller: document.getElementById('course-seller').value,
            images: Array.from(document.querySelectorAll('.image-url-input')).map(input => input.value),
            offlinePrice: document.getElementById('offline-price').value,
            offlineOriginalPrice: document.getElementById('offline-original-price').value,
            onlinePrice: document.getElementById('online-price').value,
            onlineOriginalPrice: document.getElementById('online-original-price').value,
            toolsLanguage: Array.from(document.querySelectorAll('.tools-language-input')).map(input => input.value),
            learn: Array.from(document.querySelectorAll('#learn-items-container input')).map(input => input.value),
            curriculum: Array.from(document.querySelectorAll('#curriculum-container .form-group')).map(section => ({
                title: section.querySelector('.section-title input').value,
                lectures: Array.from(section.querySelectorAll('.curriculum-item input')).map(input => input.value)
            }))
        };

        localStorage.setItem('courseDraft', JSON.stringify(formData));
    }

    function loadCourseDraft() {
        const draft = localStorage.getItem('courseDraft');
        if (draft && !currentCourseId) {
            const formData = JSON.parse(draft);
            
            document.getElementById('course-title').value = formData.title || '';
            document.getElementById('course-description').value = formData.description || '';
            document.getElementById('course-mini-description').value = formData.miniDescription || '';
            document.getElementById('course-category').value = formData.category || '';
            document.getElementById('other-category').value = formData.otherCategory || '';
            document.getElementById('course-seller').value = formData.seller || '';
            
            // Handle other category visibility
            const otherCategoryContainer = document.getElementById('other-category-container');
            if (formData.category === 'other') {
                otherCategoryContainer.classList.remove('hidden');
            } else {
                otherCategoryContainer.classList.add('hidden');
            }

            // Handle images
            const imageContainer = document.getElementById('image-items-container');
            imageContainer.innerHTML = '';
            if (formData.images && formData.images.length > 0) {
                formData.images.forEach((image, index) => {
                    const imageItem = createImageItem();
                    imageItem.querySelector('.image-url-input').value = image;
                    imageContainer.appendChild(imageItem);
                });
            } else {
                imageContainer.appendChild(createImageItem());
            }
            updateImagePreviews();

            // Handle pricing
            document.getElementById('offline-price').value = formData.offlinePrice || '';
            document.getElementById('offline-original-price').value = formData.offlineOriginalPrice || '';
            document.getElementById('online-price').value = formData.onlinePrice || '';
            document.getElementById('online-original-price').value = formData.onlineOriginalPrice || '';

            // Handle learning tools & language
            const toolsContainer = document.getElementById('tools-language-container');
            toolsContainer.innerHTML = '';
            if (formData.toolsLanguage && formData.toolsLanguage.length > 0) {
                formData.toolsLanguage.forEach(tool => {
                    const toolItem = createToolsLanguageItem();
                    toolItem.querySelector('.tools-language-input').value = tool;
                    toolsContainer.appendChild(toolItem);
                });
            } else {
                toolsContainer.appendChild(createToolsLanguageItem());
            }

            // Handle learning points
            const learnContainer = document.getElementById('learn-items-container');
            learnContainer.innerHTML = '';
            if (formData.learn && formData.learn.length > 0) {
                formData.learn.forEach(point => {
                    const learnItem = createLearnItem();
                    learnItem.querySelector('input').value = point;
                    learnContainer.appendChild(learnItem);
                });
            } else {
                learnContainer.appendChild(createLearnItem());
            }

            // Handle curriculum
            const curriculumContainer = document.getElementById('curriculum-container');
            curriculumContainer.innerHTML = '';
            if (formData.curriculum && formData.curriculum.length > 0) {
                formData.curriculum.forEach(section => {
                    const sectionElement = createCurriculumSection(section.title);
                    const lecturesContainer = sectionElement.querySelector('.curriculum-lectures');
                    
                    section.lectures.forEach(lecture => {
                        const lectureItem = createCurriculumItem();
                        lectureItem.querySelector('input').value = lecture;
                        lecturesContainer.appendChild(lectureItem);
                    });
                    
                    curriculumContainer.appendChild(sectionElement);
                });
            } else {
                curriculumContainer.appendChild(createCurriculumSection('Introduction'));
            }

            setupDynamicFormElements();
            validateForm();
        }
    }

    function clearCourseDraft() {
        localStorage.removeItem('courseDraft');
    }

    async function handleSaveCourse(e) {
        e.preventDefault();

        if (!validateForm()) {
            showToast('Please fix the errors in the form', 'error');
            return;
        }

        try {
            const token = localStorage.getItem('adminToken');
            const formData = getCourseFormData();

            showToast('Saving course...', 'info');

            let response;
            if (currentCourseId) {
                // Update existing course
                response = await fetch(`${API_BASE}/api/courses/${currentCourseId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });
            } else {
                // Create new course
                response = await fetch(`${API_BASE}/api/courses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });
            }

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Failed to save course: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();

            if (result.success) {
                showToast(`Course ${currentCourseId ? 'updated' : 'created'} successfully!`, 'success');
                clearCourseDraft();
                showCoursesList();
                loadCourses();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showToast('Failed to save course. Please try again.', 'error');
        }
    }

    function getCourseFormData() {
        const categorySelect = document.getElementById('course-category');
        const selectedCategory = categorySelect.value;
        
        return {
            title: document.getElementById('course-title').value,
            description: document.getElementById('course-description').value,
            miniDescription: document.getElementById('course-mini-description').value,
            category: selectedCategory === 'other' ? document.getElementById('other-category').value : selectedCategory,
            seller: document.getElementById('course-seller').value,
            images: Array.from(document.querySelectorAll('.image-url-input'))
                .map(input => input.value.trim())
                .filter(url => url),
            offlinePrice: parseFloat(document.getElementById('offline-price').value) || 0,
            offlineOriginalPrice: parseFloat(document.getElementById('offline-original-price').value) || 0,
            onlinePrice: parseFloat(document.getElementById('online-price').value) || 0,
            onlineOriginalPrice: parseFloat(document.getElementById('online-original-price').value) || 0,
            toolsLanguage: Array.from(document.querySelectorAll('.tools-language-input'))
                .map(input => input.value.trim())
                .filter(tool => tool),
            learn: Array.from(document.querySelectorAll('#learn-items-container input'))
                .map(input => input.value.trim())
                .filter(point => point),
            curriculum: Array.from(document.querySelectorAll('#curriculum-container .form-group')).map(section => ({
                title: section.querySelector('.section-title input').value.trim(),
                lectures: Array.from(section.querySelectorAll('.curriculum-item input'))
                    .map(input => input.value.trim())
                    .filter(lecture => lecture)
            }))
        };
    }

    function handleSearch(e) {
        searchTerm = e.target.value.toLowerCase();
        currentPage = 1;
        renderCoursesTable();
    }

    function renderCoursesTable() {
        let filteredCourses = courses.filter(course => 
            course.title.toLowerCase().includes(searchTerm) ||
            course.description.toLowerCase().includes(searchTerm) ||
            (course.category && course.category.toLowerCase().includes(searchTerm))
        );

        // Sort courses
        filteredCourses.sort((a, b) => {
            let aValue = a[sortField];
            let bValue = b[sortField];

            if (sortField === 'price') {
                aValue = a.onlinePrice || a.offlinePrice || 0;
                bValue = b.onlinePrice || b.offlinePrice || 0;
            }

            if (typeof aValue === 'string') {
                aValue = aValue.toLowerCase();
                bValue = bValue.toLowerCase();
            }

            if (sortOrder === 'asc') {
                return aValue > bValue ? 1 : -1;
            } else {
                return aValue < bValue ? 1 : -1;
            }
        });

        // Pagination
        const totalPages = Math.ceil(filteredCourses.length / coursesPerPage);
        const startIndex = (currentPage - 1) * coursesPerPage;
        const paginatedCourses = filteredCourses.slice(startIndex, startIndex + coursesPerPage);

        // Render table
        coursesTableBody.innerHTML = '';

        if (paginatedCourses.length === 0) {
            coursesTableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center">No courses found</td>
                </tr>
            `;
        } else {
            paginatedCourses.forEach(course => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${course.images && course.images.length > 0 ? 
                            `<img src="${course.images[0]}" alt="${course.title}" class="course-thumbnail">` : 
                            '<div class="no-image">No Image</div>'
                        }
                    </td>
                    <td>
                        <div class="course-title">${course.title}</div>
                        <div class="course-description">${course.description.substring(0, 100)}...</div>
                    </td>
                    <td>
                        <div class="price">₹${course.onlinePrice || course.offlinePrice || 0}</div>
                        ${course.onlineOriginalPrice ? `<div class="original-price">₹${course.onlineOriginalPrice}</div>` : ''}
                    </td>
                    <td>
                        <div class="students-count">${course.students || 0}</div>
                    </td>
                    <td>
                        <span class="status-badge ${course.isActive ? 'active' : 'inactive'}">
                            ${course.isActive ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon edit-btn" data-id="${course._id}" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon delete-btn" data-id="${course._id}" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn-icon toggle-btn" data-id="${course._id}" data-status="${course.isActive}" title="${course.isActive ? 'Deactivate' : 'Activate'}">
                                <i class="fas ${course.isActive ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                        </div>
                    </td>
                `;
                coursesTableBody.appendChild(row);
            });
        }

        // Render pagination
        renderPagination(totalPages, currentPage, 'courses');

        // Add event listeners to action buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const courseId = e.currentTarget.getAttribute('data-id');
                showCourseForm(courseId);
            });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const courseId = e.currentTarget.getAttribute('data-id');
                handleDeleteCourse(courseId);
            });
        });

        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const courseId = e.currentTarget.getAttribute('data-id');
                const currentStatus = e.currentTarget.getAttribute('data-status') === 'true';
                handleToggleCourse(courseId, currentStatus);
            });
        });
    }

    function renderPagination(totalPages, currentPage, type) {
        const container = type === 'courses' ? pagination : posterPagination;
        container.innerHTML = '';

        if (totalPages <= 1) return;

        // Previous button
        const prevButton = document.createElement('button');
        prevButton.className = 'pagination-btn';
        prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
        prevButton.disabled = currentPage === 1;
        prevButton.addEventListener('click', () => {
            if (type === 'courses') {
                currentPage--;
                renderCoursesTable();
            } else {
                currentPosterPage--;
                renderPostersTable();
            }
        });
        container.appendChild(prevButton);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement('button');
            pageButton.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
            pageButton.textContent = i;
            pageButton.addEventListener('click', () => {
                if (type === 'courses') {
                    currentPage = i;
                    renderCoursesTable();
                } else {
                    currentPosterPage = i;
                    renderPostersTable();
                }
            });
            container.appendChild(pageButton);
        }

        // Next button
        const nextButton = document.createElement('button');
        nextButton.className = 'pagination-btn';
        nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
        nextButton.disabled = currentPage === totalPages;
        nextButton.addEventListener('click', () => {
            if (type === 'courses') {
                currentPage++;
                renderCoursesTable();
            } else {
                currentPosterPage++;
                renderPostersTable();
            }
        });
        container.appendChild(nextButton);
    }

    async function handleDeleteCourse(courseId) {
        showConfirmation(
            'Delete Course',
            'Are you sure you want to delete this course? This action cannot be undone.',
            async () => {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`${API_BASE}/api/courses/${courseId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to delete course');
                    }

                    const result = await response.json();

                    if (result.success) {
                        showToast('Course deleted successfully', 'success');
                        loadCourses();
                    } else {
                        throw new Error(result.message);
                    }
                } catch (error) {
                    showToast('Failed to delete course', 'error');
                }
            }
        );
    }

    async function handleToggleCourse(courseId, currentStatus) {
        try {
            const token = localStorage.getItem('adminToken');
            const response = await fetch(`${API_BASE}/api/courses/${courseId}/toggle`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to toggle course status');
            }

            const result = await response.json();

            if (result.success) {
                showToast(`Course ${currentStatus ? 'deactivated' : 'activated'} successfully`, 'success');
                loadCourses();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showToast('Failed to toggle course status', 'error');
        }
    }

    function showConfirmation(title, message, onConfirm) {
        confirmationTitle.textContent = title;
        confirmationMessage.textContent = message;
        confirmationModal.classList.remove('hidden');

        confirmationConfirm.onclick = () => {
            confirmationModal.classList.add('hidden');
            onConfirm();
        };
    }

    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas ${getToastIcon(type)}"></i>
                <span>${message}</span>
            </div>
            <button class="toast-close">
                <i class="fas fa-times"></i>
            </button>
        `;

        toastContainer.appendChild(toast);

        // Auto remove after 5 seconds
        setTimeout(() => {
            if (toast.parentElement) {
                toast.remove();
            }
        }, 5000);

        // Close button
        toast.querySelector('.toast-close').addEventListener('click', () => {
            toast.remove();
        });
    }

    function getToastIcon(type) {
        switch (type) {
            case 'success': return 'fa-check-circle';
            case 'error': return 'fa-exclamation-circle';
            case 'warning': return 'fa-exclamation-triangle';
            case 'info': return 'fa-info-circle';
            default: return 'fa-info-circle';
        }
    }

    async function loadAnalytics() {
        // Update stats
        document.getElementById('total-courses').textContent = courses.length;
        
        const totalStudents = courses.reduce((sum, course) => sum + (course.students || 0), 0);
        document.getElementById('total-students').textContent = totalStudents.toLocaleString();
        
        const totalRevenue = courses.reduce((sum, course) => {
            const price = course.onlinePrice || course.offlinePrice || 0;
            const students = course.students || 0;
            return sum + (price * students);
        }, 0);
        document.getElementById('total-revenue').textContent = `₹${totalRevenue.toLocaleString()}`;
        
        const completionRate = courses.length > 0 ? Math.round((totalStudents / (courses.length * 100)) * 100) : 0;
        document.getElementById('completion-rate').textContent = `${completionRate}%`;

        // Create charts
        createEnrollmentChart();
        createPopularityChart();
    }

    function createEnrollmentChart() {
        const ctx = document.getElementById('enrollment-chart').getContext('2d');
        
        if (enrollmentChart) {
            enrollmentChart.destroy();
        }

        // Sample data - in a real app, this would come from your analytics API
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
        const enrollments = [65, 59, 80, 81, 56, 55];

        enrollmentChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Monthly Enrollments',
                    data: enrollments,
                    borderColor: '#800020',
                    backgroundColor: 'rgba(128, 0, 32, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            }
        });
    }

    function createPopularityChart() {
        const ctx = document.getElementById('popularity-chart').getContext('2d');
        
        if (popularityChart) {
            popularityChart.destroy();
        }

        // Get top 5 courses by student count
        const popularCourses = [...courses]
            .sort((a, b) => (b.students || 0) - (a.students || 0))
            .slice(0, 5);

        const courseNames = popularCourses.map(course => 
            course.title.length > 20 ? course.title.substring(0, 20) + '...' : course.title
        );
        const studentCounts = popularCourses.map(course => course.students || 0);

        popularityChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: courseNames,
                datasets: [{
                    label: 'Number of Students',
                    data: studentCounts,
                    backgroundColor: '#800020',
                    borderColor: '#600018',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    async function saveSettings() {
        showToast('Settings saved successfully', 'success');
    }

    // Poster Management Functions
    async function loadPosters() {
        try {
            const token = localStorage.getItem('adminToken');
            const response = await fetch(`${API_BASE}/api/posters`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch posters');
            }

            const result = await response.json();

            if (result.success) {
                posters = result.data.posters || [];
                renderPostersTable();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showToast('Failed to load posters', 'error');
            posters = [];
            renderPostersTable();
        }
    }

    function showPostersList() {
        postersList.classList.remove('hidden');
        posterForm.classList.add('hidden');
        loadPosters();
    }

    function showPosterForm(posterId = null) {
        postersList.classList.add('hidden');
        posterForm.classList.remove('hidden');

        currentPosterId = posterId;

        if (posterId) {
            const poster = posters.find(p => p._id === posterId);
            if (poster) {
                populatePosterForm(poster);
            }
        } else {
            resetPosterForm();
        }
    }

    function populatePosterForm(poster) {
        document.getElementById('poster-title').value = poster.title || '';
        
        // Handle images
        const imageContainer = document.getElementById('poster-image-container');
        imageContainer.innerHTML = '';
        if (poster.images && poster.images.length > 0) {
            poster.images.forEach((image, index) => {
                const imageItem = createPosterImageItem();
                imageItem.querySelector('.poster-image-url').value = image;
                imageContainer.appendChild(imageItem);
            });
        } else {
            imageContainer.appendChild(createPosterImageItem());
        }
        updatePosterImagePreviews();

        // Handle content
        const contentContainer = document.getElementById('content-items-container');
        contentContainer.innerHTML = '';
        if (poster.content && poster.content.length > 0) {
            poster.content.forEach(point => {
                const contentItem = createContentItem();
                contentItem.querySelector('input').value = point;
                contentContainer.appendChild(contentItem);
            });
        } else {
            contentContainer.appendChild(createContentItem());
        }

        setupDynamicPosterFormElements();
        validatePosterForm();
    }

    function resetPosterForm() {
        document.getElementById('poster-title').value = '';
        
        // Reset images
        const imageContainer = document.getElementById('poster-image-container');
        imageContainer.innerHTML = '';
        imageContainer.appendChild(createPosterImageItem());
        updatePosterImagePreviews();

        // Reset content
        const contentContainer = document.getElementById('content-items-container');
        contentContainer.innerHTML = '';
        contentContainer.appendChild(createContentItem());

        setupDynamicPosterFormElements();
        validatePosterForm();
    }

    function createPosterImageItem() {
        const div = document.createElement('div');
        div.className = 'image-item';
        div.innerHTML = `
            <input type="url" class="form-control poster-image-url" placeholder="Enter image URL" required>
            <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
        `;
        return div;
    }

    function createContentItem() {
        const div = document.createElement('div');
        div.className = 'learn-item';
        div.innerHTML = `
            <input type="text" class="form-control content-input" placeholder="Enter content point" required>
            <button type="button" class="remove-btn"><i class="fas fa-times"></i></button>
        `;
        return div;
    }

    function setupDynamicPosterFormElements() {
        // Poster image URL inputs
        document.querySelectorAll('.poster-image-url').forEach(input => {
            input.removeEventListener('input', handlePosterImageUrlInput);
            input.addEventListener('input', handlePosterImageUrlInput);
        });

        // Remove buttons for poster images
        document.querySelectorAll('#poster-image-container .remove-btn').forEach(btn => {
            btn.removeEventListener('click', handleRemovePosterImageItem);
            btn.addEventListener('click', handleRemovePosterImageItem);
        });

        // Remove buttons for content items
        document.querySelectorAll('#content-items-container .remove-btn').forEach(btn => {
            btn.removeEventListener('click', handleRemoveContentItem);
            btn.addEventListener('click', handleRemoveContentItem);
        });

        // Add event listeners for the add buttons
        document.getElementById('add-poster-image-item').onclick = () => {
            const container = document.getElementById('poster-image-container');
            const newItem = createPosterImageItem();
            container.appendChild(newItem);
            setupDynamicPosterFormElements();
        };

        document.getElementById('add-content-item').onclick = () => {
            const container = document.getElementById('content-items-container');
            const newItem = createContentItem();
            container.appendChild(newItem);
            setupDynamicPosterFormElements();
        };

        // Add input event listeners for form validation
        document.querySelectorAll('#poster-form input').forEach(input => {
            input.removeEventListener('input', validatePosterForm);
            input.addEventListener('input', validatePosterForm);
        });
    }

    function handleRemovePosterImageItem(e) {
        const container = document.getElementById('poster-image-container');
        if (container.children.length > 1) {
            e.target.closest('.image-item').remove();
            updatePosterImagePreviews();
        } else {
            showToast('At least one image is required', 'warning');
        }
    }

    function handleRemoveContentItem(e) {
        const container = document.getElementById('content-items-container');
        if (container.children.length > 1) {
            e.target.closest('.learn-item').remove();
        } else {
            showToast('At least one content point is required', 'warning');
        }
    }

    function handlePosterImageUrlInput(e) {
        updatePosterImagePreviews();
    }

    function updatePosterImagePreviews() {
        const container = document.getElementById('poster-image-preview');
        container.innerHTML = '';

        document.querySelectorAll('.poster-image-url').forEach((input, index) => {
            const url = input.value.trim();
            if (url) {
                const preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.innerHTML = `
                    <img src="${url}" alt="Preview ${index + 1}" onerror="this.style.display='none'">
                    <span>Image ${index + 1}</span>
                `;
                container.appendChild(preview);
            }
        });
    }

    function setupPosterFormValidation() {
        const form = document.getElementById('poster-form');
        const inputs = form.querySelectorAll('input');

        inputs.forEach(input => {
            input.addEventListener('blur', (e) => validatePosterField(e.target));
            input.addEventListener('input', (e) => {
                validatePosterField(e.target);
                validatePosterForm();
            });
        });
    }

    function validatePosterField(field) {
        const errorElement = document.getElementById(`${field.id}-error`);
        if (!errorElement) return;

        let isValid = true;
        let errorMessage = '';

        switch (field.type) {
            case 'text':
                if (field.required && !field.value.trim()) {
                    isValid = false;
                    errorMessage = 'This field is required';
                }
                break;
            case 'url':
                if (field.required && !field.value.trim()) {
                    isValid = false;
                    errorMessage = 'Image URL is required';
                } else if (field.value.trim() && !isValidUrl(field.value.trim())) {
                    isValid = false;
                    errorMessage = 'Please enter a valid URL';
                }
                break;
        }

        if (isValid) {
            field.classList.remove('error');
            errorElement.style.display = 'none';
        } else {
            field.classList.add('error');
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
        }

        return isValid;
    }

    function validatePosterForm() {
        const form = document.getElementById('poster-form');
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!validatePosterField(field)) {
                isValid = false;
            }
        });

        // Validate at least one image URL
        const imageUrls = document.querySelectorAll('.poster-image-url');
        let hasValidImage = false;
        imageUrls.forEach(input => {
            if (input.value.trim() && isValidUrl(input.value.trim())) {
                hasValidImage = true;
            }
        });
        if (!hasValidImage) {
            isValid = false;
        }

        savePosterBtn.disabled = !isValid;
        return isValid;
    }

    function handleCancelPoster() {
        showPostersList();
    }

    async function handleSavePoster(e) {
        e.preventDefault();

        if (!validatePosterForm()) {
            showToast('Please fix the errors in the form', 'error');
            return;
        }

        try {
            const token = localStorage.getItem('adminToken');
            const formData = getPosterFormData();

            showToast('Saving poster...', 'info');

            let response;
            if (currentPosterId) {
                // Update existing poster
                response = await fetch(`${API_BASE}/api/posters/${currentPosterId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });
            } else {
                // Create new poster
                response = await fetch(`${API_BASE}/api/posters`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });
            }

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Failed to save poster: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();

            if (result.success) {
                showToast(`Poster ${currentPosterId ? 'updated' : 'created'} successfully!`, 'success');
                showPostersList();
                loadPosters();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showToast('Failed to save poster. Please try again.', 'error');
        }
    }

    function getPosterFormData() {
        return {
            title: document.getElementById('poster-title').value,
            images: Array.from(document.querySelectorAll('.poster-image-url'))
                .map(input => input.value.trim())
                .filter(url => url),
            content: Array.from(document.querySelectorAll('.content-input'))
                .map(input => input.value.trim())
                .filter(point => point)
        };
    }

    function handlePosterSearch(e) {
        posterSearchTerm = e.target.value.toLowerCase();
        currentPosterPage = 1;
        renderPostersTable();
    }

    function renderPostersTable() {
        let filteredPosters = posters.filter(poster => 
            poster.title.toLowerCase().includes(posterSearchTerm) ||
            (poster.content && poster.content.some(item => item.toLowerCase().includes(posterSearchTerm)))
        );

        // Sort posters
        filteredPosters.sort((a, b) => {
            let aValue = a[posterSortField];
            let bValue = b[posterSortField];

            if (typeof aValue === 'string') {
                aValue = aValue.toLowerCase();
                bValue = bValue.toLowerCase();
            }

            if (posterSortOrder === 'asc') {
                return aValue > bValue ? 1 : -1;
            } else {
                return aValue < bValue ? 1 : -1;
            }
        });

        // Pagination
        const totalPages = Math.ceil(filteredPosters.length / postersPerPage);
        const startIndex = (currentPosterPage - 1) * postersPerPage;
        const paginatedPosters = filteredPosters.slice(startIndex, startIndex + postersPerPage);

        // Render table
        postersTableBody.innerHTML = '';

        if (paginatedPosters.length === 0) {
            postersTableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center">No posters found</td>
                </tr>
            `;
        } else {
            paginatedPosters.forEach(poster => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${poster.images && poster.images.length > 0 ? 
                            `<img src="${poster.images[0]}" alt="${poster.title}" class="course-thumbnail">` : 
                            '<div class="no-image">No Image</div>'
                        }
                    </td>
                    <td>
                        <div class="course-title">${poster.title}</div>
                    </td>
                    <td>
                        <div class="content-count">${poster.content ? poster.content.length : 0} items</div>
                    </td>
                    <td>
                        <span class="status-badge ${poster.isActive ? 'active' : 'inactive'}">
                            ${poster.isActive ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon edit-btn" data-id="${poster._id}" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon delete-btn" data-id="${poster._id}" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn-icon toggle-btn" data-id="${poster._id}" data-status="${poster.isActive}" title="${poster.isActive ? 'Deactivate' : 'Activate'}">
                                <i class="fas ${poster.isActive ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                        </div>
                    </td>
                `;
                postersTableBody.appendChild(row);
            });
        }

        // Render pagination
        renderPagination(totalPages, currentPosterPage, 'posters');

        // Add event listeners to action buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const posterId = e.currentTarget.getAttribute('data-id');
                showPosterForm(posterId);
            });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const posterId = e.currentTarget.getAttribute('data-id');
                handleDeletePoster(posterId);
            });
        });

        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const posterId = e.currentTarget.getAttribute('data-id');
                const currentStatus = e.currentTarget.getAttribute('data-status') === 'true';
                handleTogglePoster(posterId, currentStatus);
            });
        });
    }

    async function handleDeletePoster(posterId) {
        showConfirmation(
            'Delete Poster',
            'Are you sure you want to delete this poster? This action cannot be undone.',
            async () => {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`${API_BASE}/api/posters/${posterId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to delete poster');
                    }

                    const result = await response.json();

                    if (result.success) {
                        showToast('Poster deleted successfully', 'success');
                        loadPosters();
                    } else {
                        throw new Error(result.message);
                    }
                } catch (error) {
                    showToast('Failed to delete poster', 'error');
                }
            }
        );
    }

    async function handleTogglePoster(posterId, currentStatus) {
        try {
            const token = localStorage.getItem('adminToken');
            const response = await fetch(`${API_BASE}/api/posters/${posterId}/toggle`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to toggle poster status');
            }

            const result = await response.json();

            if (result.success) {
                showToast(`Poster ${currentStatus ? 'deactivated' : 'activated'} successfully`, 'success');
                loadPosters();
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            showToast('Failed to toggle poster status', 'error');
        }
    }

    // Initialize the dashboard when the page loads
    document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>

</html>